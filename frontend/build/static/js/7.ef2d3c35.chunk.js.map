{"version":3,"sources":["places/scenes/PlaceForm.module.scss","places/scenes/NewPlace.js","shared/api/hooks/placesHook.js","shared/components/FormElements/ImageUpload.js","shared/components/FormElements/ImageUpload.module.scss"],"names":["module","exports","NewPlace","push","useHistory","addToast","useAuthContext","userId","useToastContext","useCreatePlace","sendCreatePlace","data","isLoading","isSuccess","error","errMessage","useForm","title","value","isValid","description","address","image","formState","inputHandler","useEffect","routes","HOME","message","submitPlaceHandler","e","a","preventDefault","formData","FormData","append","inputs","className","s","placeForm","onSubmit","asOverlay","row","id","el","type","placeTitle","label","placeholder","errorText","validators","VALIDATOR_REQUIRE","onInput","style","width","center","rows","VALIDATOR_MINLENGTH","size","disabled","getPlacesById","cancelableReq","_","config","axios","get","apiUrl","USER_PLACES","getPlaceById","PLACES","createPlaceReq","body","post","deletePlaceReq","delete","updatePlaceReq","patch","usePlacesById","useQuery","response","usePlaceById","status","useMutation","mutate","useDeletePlace","onMutate","placeId","queryCache","cancelQueries","setQueryData","prev","places","filter","p","onSettled","invalidateQueries","useUpdatePlace","onSuccess","ImageUpload","useState","file","setFile","previewUrl","setPreviewUrl","setIsValid","fileInputRef","useRef","fileReader","FileReader","onload","result","readAsDataURL","formControl","ref","accept","onChange","pickedFile","files","target","fileIsValid","length","display","cx","imageUpload","imagePreview","src","alt","onClick","current","click"],"mappings":"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","file":"static/js/7.ef2d3c35.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"placeForm\":\"PlaceForm_placeForm__xrtE_\",\"row\":\"PlaceForm_row__3-534\",\"placeTitle\":\"PlaceForm_placeTitle__UAQGO\"};","import React, { useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { routes } from '../../routes';\nimport { useCreatePlace } from '../../shared/api/hooks/placesHook';\nimport Button from '../../shared/components/FormElements/Button';\nimport ImageUpload from '../../shared/components/FormElements/ImageUpload';\nimport Input from '../../shared/components/FormElements/Input';\nimport Spinner from '../../shared/components/UIElements/Spinner';\nimport { useAuthContext } from '../../shared/hooks/authHook';\nimport { useForm } from '../../shared/hooks/formHook';\nimport { useToastContext } from '../../shared/hooks/toastHook';\nimport {\n  VALIDATOR_REQUIRE,\n  VALIDATOR_MINLENGTH,\n} from '../../shared/util/validators';\nimport s from './PlaceForm.module.scss';\n\nconst NewPlace = () => {\n  const { push } = useHistory();\n  const { userId } = useAuthContext();\n  const { addToast } = useToastContext();\n  const [\n    sendCreatePlace,\n    data,\n    isLoading,\n    isSuccess,\n    error,\n    errMessage,\n  ] = useCreatePlace();\n\n  const [formState, inputHandler] = useForm(\n    {\n      title: {\n        value: '',\n        isValid: false,\n      },\n\n      description: {\n        value: '',\n        isValid: false,\n      },\n\n      address: {\n        value: '',\n        isValid: false,\n      },\n\n      image: {\n        value: null,\n        isValid: false,\n      },\n    },\n    false,\n  );\n\n  useEffect(() => {\n    if (isSuccess) {\n      push(routes.HOME);\n      addToast('success', data.message);\n    }\n    if (error) {\n      addToast('danger', errMessage || 'Something went wrong');\n    }\n  }, [isSuccess, error]);\n\n  const submitPlaceHandler = async (e) => {\n    e.preventDefault();\n\n    const formData = new FormData();\n\n    formData.append('title', formState.inputs.title.value);\n    formData.append(\n      'description',\n      formState.inputs.description.value,\n    );\n    formData.append('address', formState.inputs.address.value);\n    formData.append('image', formState.inputs.image.value);\n\n    await sendCreatePlace(formData);\n  };\n\n  return (\n    <form className={s.placeForm} onSubmit={submitPlaceHandler}>\n      {isLoading && <Spinner asOverlay />}\n\n      <div className={s.row}>\n        <Input\n          id=\"title\"\n          el=\"input\"\n          type=\"text\"\n          className={s.placeTitle}\n          label=\"Title\"\n          placeholder=\"Type here title\"\n          errorText=\"Please enter a valid name.\"\n          validators={[VALIDATOR_REQUIRE()]}\n          onInput={inputHandler}\n        />\n\n        <ImageUpload\n          id=\"image\"\n          onInput={inputHandler}\n          style={{ width: '20rem' }}\n          center\n        />\n      </div>\n\n      <Input\n        id=\"description\"\n        el=\"textarea\"\n        label=\"Description\"\n        placeholder=\"Type here description\"\n        errorText=\"Please enter a valid description (at least 5 characters).\"\n        rows={10}\n        validators={[VALIDATOR_MINLENGTH(5)]}\n        onInput={inputHandler}\n      />\n\n      <Input\n        id=\"address\"\n        el=\"input\"\n        label=\"Address\"\n        placeholder=\"Type here address\"\n        errorText=\"Please enter a valid address\"\n        validators={[VALIDATOR_REQUIRE()]}\n        onInput={inputHandler}\n      />\n\n      <Button size=\"big\" type=\"submit\" disabled={!formState.isValid}>\n        ADD PLACE\n      </Button>\n    </form>\n  );\n};\n\nexport default NewPlace;\n","import axios from 'axios';\nimport { useQuery, useMutation, queryCache } from 'react-query';\nimport { cancelableReq } from '../cancelableReq';\nimport { apiUrl } from '../urls';\n\nconst getPlacesById = cancelableReq(async (_, id, config) => {\n  const { data } = await axios.get(\n    `${apiUrl.USER_PLACES}/${id}`,\n    config,\n  );\n\n  return data;\n});\n\nconst getPlaceById = cancelableReq(async (_, id, config) => {\n  const { data } = await axios.get(`${apiUrl.PLACES}/${id}`, config);\n\n  return data;\n});\n\nconst createPlaceReq = cancelableReq(async (body, config) => {\n  const { data } = await axios.post(apiUrl.PLACES, body, config);\n\n  return data;\n});\n\nconst deletePlaceReq = cancelableReq(async (id, config) => {\n  const { data } = await axios.delete(\n    `${apiUrl.PLACES}/${id}`,\n    config,\n  );\n\n  return data;\n});\n\nconst updatePlaceReq = cancelableReq(async ({ id, body }, config) => {\n  const { data } = await axios.patch(\n    `${apiUrl.PLACES}/${id}`,\n    body,\n    config,\n  );\n\n  return data;\n});\n\nexport const usePlacesById = (id) => {\n  const { isLoading, data, error } = useQuery(\n    ['userPlaces', id],\n    getPlacesById,\n  );\n  let errMessage = error?.response?.data;\n\n  return [data, isLoading, errMessage];\n};\n\nexport const usePlaceById = (id) => {\n  const { isLoading, data, error } = useQuery(\n    ['userPlace', id],\n    getPlaceById,\n  );\n  let errStatus = error?.response?.status;\n\n  return [data, isLoading, errStatus];\n};\n\nexport const useCreatePlace = () => {\n  const [mutate, { data, error, isSuccess, isLoading }] = useMutation(\n    createPlaceReq,\n  );\n  let errMessage = error?.response?.data;\n\n  return [mutate, data, isLoading, isSuccess, error, errMessage];\n};\n\nexport const useDeletePlace = (userId) => {\n  const [mutate, { data, error, isSuccess, isLoading }] = useMutation(\n    deletePlaceReq,\n    {\n      onMutate: (placeId) => {\n        queryCache.cancelQueries(['userPlaces', userId]);\n        queryCache.setQueryData(['userPlaces', userId], (prev) => {\n          return prev.places.filter((p) => p.id !== placeId);\n        });\n      },\n      onSettled: () => {\n        queryCache.invalidateQueries('userPlaces');\n      },\n    },\n  );\n  let errMessage = error?.response?.data;\n\n  return [mutate, data, isLoading, isSuccess, error, errMessage];\n};\n\nexport const useUpdatePlace = () => {\n  const [mutate, { data, isLoading, isSuccess }] = useMutation(\n    updatePlaceReq,\n    {\n      onSuccess: () => {\n        queryCache.invalidateQueries('userPlace');\n      },\n    },\n  );\n\n  return [mutate, data, isLoading, isSuccess];\n};\n","import cx from 'classnames';\nimport React, { useRef, useState, useEffect } from 'react';\nimport Button from './Button';\nimport s from './ImageUpload.module.scss';\n\nconst ImageUpload = ({ id, onInput, center, style }) => {\n  const [file, setFile] = useState();\n  const [previewUrl, setPreviewUrl] = useState();\n  const [isValid, setIsValid] = useState(false);\n\n  const fileInputRef = useRef();\n\n  useEffect(() => {\n    if (!file) {\n      return;\n    }\n    const fileReader = new FileReader();\n    fileReader.onload = () => {\n      setPreviewUrl(fileReader.result);\n    };\n    fileReader.readAsDataURL(file);\n  }, [file]);\n\n  const pickedHandler = (e) => {\n    const files = e.target.files;\n    let pickedFile;\n    let fileIsValid = isValid;\n\n    if (files && files.length === 1) {\n      pickedFile = files[0];\n\n      setFile(pickedFile);\n      setIsValid(true);\n      fileIsValid = true;\n    } else {\n      setIsValid(false);\n      fileIsValid = false;\n    }\n\n    onInput(id, pickedFile, fileIsValid);\n  };\n\n  const pickImageHandler = () => {\n    fileInputRef.current.click();\n  };\n\n  return (\n    <div className={s.formControl} style={style}>\n      <input\n        id={id}\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\".png,.jpg,.jpeg\"\n        onChange={pickedHandler}\n        style={{ display: 'none' }}\n      />\n\n      <div className={cx(s.imageUpload, { [s.center]: center })}>\n        <div className={s.imagePreview}>\n          {previewUrl && <img src={previewUrl} alt=\"Preview\" />}\n          {!previewUrl && <p>Please pick an image.</p>}\n        </div>\n\n        <Button type=\"button\" size=\"small\" onClick={pickImageHandler}>\n          PICK IMAGE\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport default ImageUpload;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"formControl\":\"ImageUpload_formControl__PWJYi\",\"imageUpload\":\"ImageUpload_imageUpload__37vNi\",\"center\":\"ImageUpload_center__2SuEp\",\"imagePreview\":\"ImageUpload_imagePreview__23K0L\"};"],"sourceRoot":""}